# Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ÛŒ API

## Ø®Ù„Ø§ØµÙ‡

**Remnawave Bedolaga Bot** ÛŒÚ© REST API Ø¬Ø§Ù…Ø¹ Ø¨Ø§ FastAPI Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú©Ù‡ Ø´Ø§Ù…Ù„ Û³Û² Ù…Ø§Ú˜ÙˆÙ„ Ø±ÙˆØª Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ… Ø§Ø³Øª.

- **ÙØ±ÛŒÙ…â€ŒÙˆØ±Ú©:** FastAPI
- **Ù¾ÙˆØ±Øª:** 8080
- **Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª:** X-API-Key Header
- **Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ:** Swagger UI Ø¯Ø± `/docs` (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)

## Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ API

### ğŸ¥ Ø³Ù„Ø§Ù…Øª Ùˆ Ù†Ø¸Ø§Ø±Øª

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `health` | `/health/*` | ÙˆØ¶Ø¹ÛŒØª Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ |
| `stats` | `/stats/*` | Ø¢Ù…Ø§Ø± Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ |
| `logs` | `/logs/*` | Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… |

### ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `users` | `/users/*` | CRUD Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ø¬Ø³ØªØ¬ÙˆØŒ ÙÛŒÙ„ØªØ± |
| `subscriptions` | `/subscriptions/*` | Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§ |
| `transactions` | `/transactions/*` | ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ |
| `user_messages` | `/user-messages/*` | Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† |

### ğŸ« Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `tickets` | `/tickets/*` | Ø³ÛŒØ³ØªÙ… ØªÛŒÚ©Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ |
| `support_settings` | `/support-settings/*` | ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ |

### ğŸ Ù¾Ø±ÙˆÙ…ÙˆØ´Ù† Ùˆ ØªØ®ÙÛŒÙ

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `promocodes` | `/promocodes/*` | Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø¯Ù‡Ø§ÛŒ ØªØ®ÙÛŒÙ |
| `promo_groups` | `/promo-groups/*` | Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ®ÙÛŒÙ |
| `promo_offers` | `/promo-offers/*` | Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª ÙˆÛŒÚ˜Ù‡ |
| `campaigns` | `/campaigns/*` | Ú©Ù…Ù¾ÛŒÙ†â€ŒÙ‡Ø§ÛŒ ØªØ¨Ù„ÛŒØºØ§ØªÛŒ |

### ğŸ“¢ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `broadcasts` | `/broadcasts/*` | Ø±Ø³Ø§Ù†Ø¯Ù† Ù¾ÛŒØ§Ù… Ú¯Ø±ÙˆÙ‡ÛŒ |
| `pinned_messages` | `/pinned-messages/*` | Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ø¬Ø§Ù‚â€ŒØ´Ø¯Ù‡ |
| `welcome_texts` | `/welcome-texts/*` | Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ |

### âš™ï¸ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `config` | `/config/*` | ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ… |
| `settings` | `/settings/*` | ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª |
| `main_menu_buttons` | `/main-menu-buttons/*` | Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ |
| `menu_layout` | `/menu-layout/*` | Ú†ÛŒØ¯Ù…Ø§Ù† Ù…Ù†Ùˆ |
| `pages` | `/pages/*` | ØµÙØ­Ø§Øª Ù…Ø­ØªÙˆØ§ |

### ğŸ–¥ï¸ Ø³Ø±ÙˆØ± Ùˆ Ø²ÛŒØ±Ø³Ø§Ø®Øª

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `servers` | `/servers/*` | Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÙˆØ±Ù‡Ø§ |
| `remnawave` | `/remnawave/*` | ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Remnawave |
| `backups` | `/backups/*` | Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ |
| `tokens` | `/tokens/*` | Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ API |

### ğŸ“± Mini App

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `miniapp` | `/miniapp/*` | API Ø¨Ø±Ø§ÛŒ Mini App ØªÙ„Ú¯Ø±Ø§Ù… |
| `media` | `/media/*` | Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø³Ø§Ù†Ù‡ |

### ğŸ† Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ùˆ Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `contests` | `/contests/*` | Ù…Ø³Ø§Ø¨Ù‚Ø§Øª |
| `polls` | `/polls/*` | Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§ |

### ğŸ¤ Ù‡Ù…Ú©Ø§Ø±Ø§Ù†

| Ù…Ø§Ú˜ÙˆÙ„ | Ù…Ø³ÛŒØ± | ØªÙˆØ¶ÛŒØ­ |
|-------|------|-------|
| `partners` | `/partners/*` | Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ú©Ø§Ø±Ø§Ù† |
| `subscription_events` | `/subscription-events/*` | Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú© |

## Endpoints Ø§ØµÙ„ÛŒ

### Health Endpoints

```
GET  /health              # ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒ Ø³ÛŒØ³ØªÙ…
GET  /health/unified      # ÙˆØ¶Ø¹ÛŒØª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ ØªÙ…Ø§Ù… Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
GET  /health/telegram-webhook    # ÙˆØ¶Ø¹ÛŒØª webhook ØªÙ„Ú¯Ø±Ø§Ù…
GET  /health/payment-webhooks    # ÙˆØ¶Ø¹ÛŒØª webhookâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª
```

### Users Endpoints

```
GET    /users              # Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ ÙÛŒÙ„ØªØ± Ùˆ ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
GET    /users/{id}         # Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø±
PATCH  /users/{id}         # Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Ø¨Ø±
POST   /users/{id}/balance # ØªØºÛŒÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ÛŒ
POST   /users/{id}/block   # Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù†
POST   /users/{id}/unblock # Ø±ÙØ¹ Ù…Ø³Ø¯ÙˆØ¯ÛŒ
```

### Subscriptions Endpoints

```
GET    /subscriptions                    # Ù„ÛŒØ³Øª Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§
GET    /subscriptions/{id}               # Ø¬Ø²Ø¦ÛŒØ§Øª Ø§Ø´ØªØ±Ø§Ú©
POST   /subscriptions/{id}/extend        # ØªÙ…Ø¯ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú©
POST   /subscriptions/{id}/reduce        # Ú©Ø§Ù‡Ø´ Ù…Ø¯Øª
PATCH  /subscriptions/{id}/traffic       # ØªØºÛŒÛŒØ± ØªØ±Ø§ÙÛŒÚ©
PATCH  /subscriptions/{id}/devices       # ØªØºÛŒÛŒØ± ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø³ØªÚ¯Ø§Ù‡
```

### Promocodes Endpoints

```
GET    /promocodes              # Ù„ÛŒØ³Øª Ú©Ø¯Ù‡Ø§ÛŒ ØªØ®ÙÛŒÙ
POST   /promocodes              # Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø¯ Ø¬Ø¯ÛŒØ¯
GET    /promocodes/{id}         # Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø¯
DELETE /promocodes/{id}         # Ø­Ø°Ù Ú©Ø¯
GET    /promocodes/{id}/usages  # ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡
```

### Servers Endpoints

```
GET    /servers              # Ù„ÛŒØ³Øª Ø³Ø±ÙˆØ±Ù‡Ø§
GET    /servers/{id}         # Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ø±ÙˆØ±
PATCH  /servers/{id}         # Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø±ÙˆØ±
POST   /servers/sync         # Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Remnawave
```

### Broadcasts Endpoints

```
GET    /broadcasts              # Ù„ÛŒØ³Øª Ø±Ø³Ø§Ù†Ø¯Ù†â€ŒÙ‡Ø§
POST   /broadcasts              # Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø³Ø§Ù†Ø¯Ù† Ø¬Ø¯ÛŒØ¯
GET    /broadcasts/{id}         # Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø³Ø§Ù†Ø¯Ù†
POST   /broadcasts/{id}/cancel  # Ù„ØºÙˆ Ø±Ø³Ø§Ù†Ø¯Ù†
```

### Backups Endpoints

```
GET    /backups              # Ù„ÛŒØ³Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§
POST   /backups              # Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¬Ø¯ÛŒØ¯
GET    /backups/{id}         # Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
POST   /backups/restore      # Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†
```

### Stats Endpoints

```
GET  /stats/overview         # Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
GET  /stats/users            # Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
GET  /stats/subscriptions    # Ø¢Ù…Ø§Ø± Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§
GET  /stats/revenue          # Ø¢Ù…Ø§Ø± Ø¯Ø±Ø¢Ù…Ø¯
GET  /stats/traffic          # Ø¢Ù…Ø§Ø± ØªØ±Ø§ÙÛŒÚ©
```

## Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

### Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

1. **X-API-Key Header** (Ø§ØµÙ„ÛŒ)
   ```http
   X-API-Key: your-api-token
   ```

2. **Bearer Token**
   ```http
   Authorization: Bearer your-api-token
   ```

### Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÚ©Ù†â€ŒÙ‡Ø§

```
GET    /tokens              # Ù„ÛŒØ³Øª ØªÙˆÚ©Ù†â€ŒÙ‡Ø§
POST   /tokens              # Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù† Ø¬Ø¯ÛŒØ¯
DELETE /tokens/{id}         # Ø¨Ø§Ø·Ù„ Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù†
POST   /tokens/{id}/revoke  # ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†
POST   /tokens/{id}/activate # ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
```

## Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯

### Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²

```json
{
  "success": true,
  "data": { ... },
  "message": "Operation completed successfully"
}
```

### Ø®Ø·Ø§

```json
{
  "detail": "Error message",
  "status_code": 400
}
```

### ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ

```json
{
  "items": [ ... ],
  "total": 100,
  "page": 1,
  "size": 20,
  "pages": 5
}
```

## ØªÚ¯â€ŒÙ‡Ø§ÛŒ OpenAPI

API Ø§Ø² ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯:

| ØªÚ¯ | ØªÙˆØ¶ÛŒØ­ |
|----|-------|
| `health` | Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ ÙˆØ¶Ø¹ÛŒØª |
| `stats` | Ø¢Ù…Ø§Ø± Ùˆ Ú¯Ø²Ø§Ø±Ø´ |
| `settings` | Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ |
| `main-menu` | Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ |
| `menu-layout` | Ú†ÛŒØ¯Ù…Ø§Ù† Ù…Ù†Ùˆ |
| `welcome-texts` | Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ |
| `users` | Ú©Ø§Ø±Ø¨Ø±Ø§Ù† |
| `subscriptions` | Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§ |
| `support` | Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ |
| `transactions` | ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ |
| `promo-groups` | Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ®ÙÛŒÙ |
| `servers` | Ø³Ø±ÙˆØ±Ù‡Ø§ |
| `promo-offers` | Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª ÙˆÛŒÚ˜Ù‡ |
| `promocodes` | Ú©Ø¯Ù‡Ø§ÛŒ ØªØ®ÙÛŒÙ |
| `broadcasts` | Ø±Ø³Ø§Ù†Ø¯Ù† Ù¾ÛŒØ§Ù… |
| `campaigns` | Ú©Ù…Ù¾ÛŒÙ†â€ŒÙ‡Ø§ |
| `pages` | ØµÙØ­Ø§Øª |
| `backups` | Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ |
| `tokens` | ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ API |
| `remnawave` | ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ |
| `miniapp` | Mini App |
| `polls` | Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ |
| `contests` | Ù…Ø³Ø§Ø¨Ù‚Ø§Øª |
| `partners` | Ù‡Ù…Ú©Ø§Ø±Ø§Ù† |

## CORS

```python
origins = settings.WEB_API_ALLOWED_ORIGINS.split(",")
# Ù¾ÛŒØ´â€ŒÙØ±Ø¶: "*" (Ù‡Ù…Ù‡ originâ€ŒÙ‡Ø§ Ù…Ø¬Ø§Ø²)
```

## Middleware

1. **RequestLoggingMiddleware** - Ù„Ø§Ú¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
2. **CORSMiddleware** - Ù…Ø¯ÛŒØ±ÛŒØª CORS

---

*ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ú¯Ø±Ø¯Ø´â€ŒÚ©Ø§Ø± document-project Ø¯Ø± 2025-12-25*
*ØªØ¹Ø¯Ø§Ø¯ endpointâ€ŒÙ‡Ø§: ~Û±ÛµÛ°+*

