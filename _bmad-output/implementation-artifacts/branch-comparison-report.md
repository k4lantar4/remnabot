# Ú¯Ø²Ø§Ø±Ø´ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ Ùˆ ØªØ­Ù„ÛŒÙ„ ØªØ¶Ø§Ø¯Ù‡Ø§

**Ù¾Ø±ÙˆÚ˜Ù‡:** remnabot Multi-Tenant SaaS  
**ØªØ§Ø±ÛŒØ®:** 2025-12-26  
**Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡:** Winston (Architect Agent)  
**Ù‡Ø¯Ù:** Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ø¯Ù‡Ø§ÛŒ ØªÙ…ÛŒØ² Ù‚Ø§Ø¨Ù„ merge Ùˆ Ú©Ø¯Ù‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ

---

## ğŸ“Š Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ

### ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§

| Ø¨Ø±Ù†Ú† | Commit Count | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|------|-------------|-------|---------|
| **reagain-init** (ÙØ¹Ù„ÛŒ) | 314 commits ahead | âœ… Active Development | Ø´Ø§Ù…Ù„ BMAD artifacts + CloudPayments |
| **origin/dev** | 27 commits ahead | âœ… Upstream | Ø´Ø§Ù…Ù„ ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø§Ø² upstream |
| **origin/fix/replace-kopek-to-toman** | - | âš ï¸ Currency Fix | ØªØ¨Ø¯ÛŒÙ„ kopek Ø¨Ù‡ toman - **Ù…ÙÛŒØ¯** |
| **origin/debug/language** | - | âš ï¸ Language Debug | Ø¨Ù‡Ø¨ÙˆØ¯ localization - **Ù…ÙÛŒØ¯** |
| **origin/feat/payments** | - | âš ï¸ Payments Feature | ØªØºÛŒÛŒØ±Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª - **Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ** |
| **origin/feat/tenant** | - | âš ï¸ Tenant Feature | ØªØºÛŒÛŒØ±Ø§Øª tenant - **Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ** |
| **origin/feat/multi-tenant-0** | - | ğŸš¨ **Ø§Ù†Ø­Ø±Ø§Ù Ø§Ø² PRD** | Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² "Bot" Ø¨Ù‡ Ø¬Ø§ÛŒ "Tenant" |
| **origin/feat/multi-tenant-1** | - | ğŸš¨ **Ø§Ù†Ø­Ø±Ø§Ù Ø§Ø² PRD** | Ø§Ø¯Ø§Ù…Ù‡ multi-tenant-0 |

### Ø¢Ù…Ø§Ø± ØªÙØ§ÙˆØªâ€ŒÙ‡Ø§

- **145 ÙØ§ÛŒÙ„** ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯
- **31,630 Ø®Ø·** Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡
- **1,037 Ø®Ø·** Ø­Ø°Ù Ø´Ø¯Ù‡
- **Ø®Ø§Ù„Øµ:** +30,593 Ø®Ø· Ú©Ø¯

---

## ğŸ¯ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ

### Ø±ÙˆÛŒÚ©Ø±Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ

1. **Ú©Ø¯Ù‡Ø§ÛŒ ØªÙ…ÛŒØ²** â†’ Merge Ù…Ø³ØªÙ‚ÛŒÙ… (Ø¨Ø¯ÙˆÙ† conflict)
2. **Ú©Ø¯Ù‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡** â†’ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ PRD (Ø­Ø°Ù Russian gateways)
3. **Ú©Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯** â†’ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ùˆ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ

---

## âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙ…ÛŒØ² - Ù‚Ø§Ø¨Ù„ Merge Ù…Ø³ØªÙ‚ÛŒÙ…

### Ø¯Ø³ØªÙ‡ 1: BMAD Artifacts (100% ØªÙ…ÛŒØ²)

Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ÙÙ‚Ø· Ù…Ø³ØªÙ†Ø¯Ø§Øª Ùˆ planning Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ù‡ÛŒÚ† conflict Ù†Ø¯Ø§Ø±Ù†Ø¯:

```
âœ… _bmad-output/analysis/brainstorming-session-2025-12-25.md
âœ… _bmad-output/architecture.md
âœ… _bmad-output/prd.md
âœ… _bmad-output/project-context.md
âœ… _bmad-output/project-planning-artifacts/* (ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§)
âœ… _bmad-output/implementation-artifacts/* (ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§)
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:** Merge Ù…Ø³ØªÙ‚ÛŒÙ… - Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ÙÙ‚Ø· Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù‡Ø³ØªÙ†Ø¯.

---

### Ø¯Ø³ØªÙ‡ 2: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Russian Gateway

Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¬Ø¯ÛŒØ¯ Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø¯Ø± origin/dev ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ù†Ø¯:

#### CloudPayments Integration (14 ÙØ§ÛŒÙ„)

```
âœ… app/database/crud/cloudpayments.py          # NEW - ØªÙ…ÛŒØ²
âœ… app/services/cloudpayments_service.py       # NEW - ØªÙ…ÛŒØ²
âœ… app/services/payment/cloudpayments.py       # NEW - ØªÙ…ÛŒØ²
âœ… app/handlers/balance/cloudpayments.py      # NEW - ØªÙ…ÛŒØ²
```

**ÙˆØ¶Ø¹ÛŒØª:** âœ… **ØªÙ…ÛŒØ² - Ù‚Ø§Ø¨Ù„ Merge**

**Ù†Ú©ØªÙ‡:** CloudPayments ÛŒÚ© Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±ÙˆØ³ÛŒ Ø§Ø³Øª Ø§Ù…Ø§:
- Ø¯Ø± PRD Ø°Ú©Ø± Ù†Ø´Ø¯Ù‡ (Ù†Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª Ø­Ø°ÙØŒ Ù†Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ)
- Ø¨Ø§ÛŒØ¯ ØªØµÙ…ÛŒÙ… Ø¨Ú¯ÛŒØ±ÛŒÙ…: Ø­Ø°Ù ÛŒØ§ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒØŸ

**Ø±Ø§Ù‡Ú©Ø§Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:**
- **Ú¯Ø²ÛŒÙ†Ù‡ 1:** Ø­Ø°Ù CloudPayments (Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø³Ø§ÛŒØ± Russian gateways)
- **Ú¯Ø²ÛŒÙ†Ù‡ 2:** Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ Ù…ÙˆÙ‚Øª ØªØ§ ØªØµÙ…ÛŒÙ… Ù†Ù‡Ø§ÛŒÛŒ (flag Ú©Ø±Ø¯Ù†)

---

#### Features Ø¬Ø¯ÛŒØ¯ (ØªÙ…ÛŒØ²)

```
âœ… app/handlers/admin/blacklist.py            # NEW - ØªÙ…ÛŒØ²
âœ… app/handlers/admin/bulk_ban.py             # NEW - ØªÙ…ÛŒØ²
âœ… app/handlers/admin/contests.py             # NEW - ØªÙ…ÛŒØ²
âœ… app/handlers/admin/daily_contests.py       # NEW - ØªÙ…ÛŒØ²
âœ… app/handlers/contests.py                   # NEW - ØªÙ…ÛŒØ²
âœ… app/services/blacklist_service.py         # NEW - ØªÙ…ÛŒØ²
âœ… app/services/bulk_ban_service.py          # NEW - ØªÙ…ÛŒØ²
âœ… app/services/contest_rotation_service.py   # NEW - ØªÙ…ÛŒØ²
âœ… app/services/referral_contest_service.py  # NEW - ØªÙ…ÛŒØ²
âœ… app/services/pinned_message_service.py    # NEW - ØªÙ…ÛŒØ²
âœ… app/services/traffic_monitoring_service.py # NEW - ØªÙ…ÛŒØ²
âœ… app/services/nalogo_service.py            # NEW - ØªÙ…ÛŒØ²
âœ… app/services/menu_layout/*                 # NEW - ØªÙ…ÛŒØ² (5 ÙØ§ÛŒÙ„)
âœ… app/middlewares/button_stats.py           # NEW - ØªÙ…ÛŒØ²
âœ… app/webserver/payments.py                  # NEW - ØªÙ…ÛŒØ²
```

**ÙˆØ¶Ø¹ÛŒØª:** âœ… **ØªÙ…ÛŒØ² - Ù‚Ø§Ø¨Ù„ Merge**

**Ø±Ø§Ù‡Ú©Ø§Ø±:** Merge Ù…Ø³ØªÙ‚ÛŒÙ… - Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ feature Ø¬Ø¯ÛŒØ¯ Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø¨Ø§ PRD Ø³Ø§Ø²Ú¯Ø§Ø±Ù†Ø¯.

---

### Ø¯Ø³ØªÙ‡ 3: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡ - Ø¨Ø¯ÙˆÙ† Russian Gateway

Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ø§Ù…Ø§ ØªØºÛŒÛŒØ±Ø§Øª ØªÙ…ÛŒØ² Ù‡Ø³ØªÙ†Ø¯:

```
âœ… app/database/crud/contest.py               # NEW - ØªÙ…ÛŒØ²
âœ… app/database/crud/referral_contest.py      # NEW - ØªÙ…ÛŒØ²
âœ… app/database/crud/subscription.py          # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âœ… app/database/crud/transaction.py           # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âœ… app/database/crud/user.py                  # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âœ… app/database/models.py                     # MODIFIED - âš ï¸ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ
âœ… app/database/database.py                   # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âœ… app/database/universal_migration.py        # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:** Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Russian gateway references.

---

## âš ï¸ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡ - Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ

### Ø¯Ø³ØªÙ‡ 1: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙˆÛŒ Russian Gateway (Ø­Ø°Ù Ú©Ø§Ù…Ù„)

#### External Layer (7 ÙØ§ÛŒÙ„)

```
âŒ app/external/yookassa_webhook.py          # DELETE - Russian gateway
âŒ app/external/wata_webhook.py               # DELETE - Russian gateway
âŒ app/external/pal24_client.py               # DELETE - Russian gateway
âŒ app/external/pal24_webhook.py              # DELETE - Russian gateway
âŒ app/external/heleket.py                    # DELETE - Russian gateway
âŒ app/external/heleket_webhook.py            # DELETE - Russian gateway
âŒ app/external/tribute.py                    # DELETE - Russian gateway
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:** 
- âŒ **Merge Ù†Ú©Ù†ÛŒØ¯** - Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø­Ø°Ù Ø´ÙˆÙ†Ø¯
- âœ… Ø§Ø² origin/dev Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯ - Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¯Ø± PRD Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯

---

#### Service Layer - Gateway-Specific (13 ÙØ§ÛŒÙ„)

```
âŒ app/services/wata_service.py               # DELETE
âŒ app/services/yookassa_service.py           # DELETE
âŒ app/services/tribute_service.py            # DELETE
âŒ app/services/mulenpay_service.py           # DELETE
âŒ app/services/pal24_service.py              # DELETE
âŒ app/services/platega_service.py           # DELETE
âŒ app/services/payment/heleket.py            # DELETE
âŒ app/services/payment/mulenpay.py           # DELETE
âŒ app/services/payment/pal24.py              # DELETE
âŒ app/services/payment/tribute.py            # DELETE
âŒ app/services/payment/wata.py               # DELETE
âŒ app/services/payment/platega.py            # DELETE
âŒ app/services/payment/yookassa.py           # DELETE
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:**
- âŒ **Merge Ù†Ú©Ù†ÛŒØ¯** - Ø­Ø°Ù Ú©Ø§Ù…Ù„
- âœ… Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ PRD FR10.1

---

#### Handler Layer - Balance (7 ÙØ§ÛŒÙ„)

```
âŒ app/handlers/balance/wata.py               # DELETE
âŒ app/handlers/balance/yookassa.py           # DELETE
âŒ app/handlers/balance/heleket.py            # DELETE
âŒ app/handlers/balance/mulenpay.py           # DELETE
âŒ app/handlers/balance/pal24.py              # DELETE
âŒ app/handlers/balance/platega.py            # DELETE
âŒ app/handlers/balance/tribute.py             # DELETE
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:**
- âŒ **Merge Ù†Ú©Ù†ÛŒØ¯** - Ø­Ø°Ù Ú©Ø§Ù…Ù„

---

### Ø¯Ø³ØªÙ‡ 2: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Contaminated - Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Surgical Removal

Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø­Ø§ÙˆÛŒ Russian gateway references Ù‡Ø³ØªÙ†Ø¯ Ø§Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´ÙˆÙ†Ø¯:

#### Core Service Files (P0 - Critical)

```
âš ï¸ app/services/payment_service.py           # MODIFIED - Ø­Ø§ÙˆÛŒ YooKassa + CloudPayments
âš ï¸ app/services/subscription_service.py      # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/services/user_service.py              # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/services/payment_verification_service.py # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/services/payment/__init__.py           # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/services/payment/common.py            # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
```

**ØªØ­Ù„ÛŒÙ„ `payment_service.py`:**

```python
# Ø¯Ø± Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ:
from app.services.payment.cloudpayments import CloudPaymentsPaymentMixin  # âœ… NEW
from app.services.yookassa_service import YooKassaService                # âŒ REMOVE
from app.services.wata_service import WataService                        # âŒ REMOVE

class PaymentService(
    CloudPaymentsPaymentMixin,  # âœ… NEW
    YooKassaPaymentMixin,       # âŒ REMOVE
    WataPaymentMixin,           # âŒ REMOVE
    # ...
):
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:**
1. âŒ **Merge Ù†Ú©Ù†ÛŒØ¯** - Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¢Ù„ÙˆØ¯Ù‡ Ø§Ø³Øª
2. âœ… Ø§Ø² Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (CloudPayments Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯)
3. âœ… Ø­Ø°Ù YooKassa, Wata, Heleket, etc. (Ø·Ø¨Ù‚ PRD FR10.1)
4. âœ… ØªØµÙ…ÛŒÙ… Ø¯Ø±Ø¨Ø§Ø±Ù‡ CloudPayments (Ø­Ø°Ù ÛŒØ§ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ)

---

#### Core Handler Files (P0 - Critical)

```
âš ï¸ app/handlers/subscription/purchase.py     # MODIFIED - 3,455 lines - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/handlers/balance/main.py              # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/handlers/simple_subscription.py       # MODIFIED - 2,420 lines - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/handlers/webhooks.py                  # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/handlers/admin/bot_configuration.py   # MODIFIED - 2,800 lines - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
âš ï¸ app/handlers/admin/payments.py             # MODIFIED - Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:**
- Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Russian gateway references
- Ø­Ø°Ù inline keyboard buttons Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Russian gateways
- Ø­Ø°Ù callback handlers Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Russian gateways

---

#### Config Files

```
âš ï¸ app/config.py                             # MODIFIED - Ø­Ø§ÙˆÛŒ CLOUDPAYMENTS + Russian gateways
```

**ØªØ­Ù„ÛŒÙ„ `config.py`:**

```python
# Ø¯Ø± Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ:
CLOUDPAYMENTS_ENABLED: bool = False          # âœ… NEW - Ø§Ù…Ø§ Russian gateway Ø§Ø³Øª
YOOKASSA_ENABLED: bool = False              # âŒ REMOVE
WATA_ENABLED: bool = False                  # âŒ REMOVE
HELEKET_ENABLED: bool = False               # âŒ REMOVE
# ... Ø³Ø§ÛŒØ± Russian gateways
```

**Ø±Ø§Ù‡Ú©Ø§Ø±:**
1. âœ… Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ CloudPayments config (Ù…ÙˆÙ‚Øª - ØªØ§ ØªØµÙ…ÛŒÙ… Ù†Ù‡Ø§ÛŒÛŒ)
2. âŒ Ø­Ø°Ù ØªÙ…Ø§Ù… Russian gateway configs (YooKassa, Wata, Heleket, etc.)
3. âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ZarinPal config (Ø·Ø¨Ù‚ PRD)

---

## ğŸ”„ ØªØ¶Ø§Ø¯Ù‡Ø§ Ùˆ Ø±Ø§Ù‡Ú©Ø§Ø±Ù‡Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡

### ØªØ¶Ø§Ø¯ 1: CloudPayments Integration

**Ù…Ø´Ú©Ù„:**
- Ø¯Ø± Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ CloudPayments Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡
- Ø¯Ø± PRD Ø°Ú©Ø± Ù†Ø´Ø¯Ù‡ (Ù†Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª Ø­Ø°ÙØŒ Ù†Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ)
- CloudPayments ÛŒÚ© Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±ÙˆØ³ÛŒ Ø§Ø³Øª

**Ø±Ø§Ù‡Ú©Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡:**

**Ú¯Ø²ÛŒÙ†Ù‡ A: Ø­Ø°Ù CloudPayments (ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)**
```python
# Ø­Ø°Ù ØªÙ…Ø§Ù… CloudPayments references
- app/database/crud/cloudpayments.py
- app/services/cloudpayments_service.py
- app/services/payment/cloudpayments.py
- app/handlers/balance/cloudpayments.py
- CLOUDPAYMENTS_* configs Ø§Ø² app/config.py
```

**Ú¯Ø²ÛŒÙ†Ù‡ B: Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ Ù…ÙˆÙ‚Øª**
- Flag Ú©Ø±Ø¯Ù† CloudPayments Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† "deprecated"
- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ø­Ø°Ù Ø¯Ø± PRD
- Ø­Ø°Ù Ø¯Ø± ÙØ§Ø² cleanup

**ØªÙˆØµÛŒÙ‡:** **Ú¯Ø²ÛŒÙ†Ù‡ A** - Ø­Ø°Ù Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ PRD

---

### ØªØ¶Ø§Ø¯ 2: Russian Gateway Removal vs Origin/Dev

**Ù…Ø´Ú©Ù„:**
- Ø¯Ø± origin/dev Ù…Ù…Ú©Ù† Ø§Ø³Øª Russian gateways ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯
- Ø¯Ø± PRD FR10.1 Ø­Ø°Ù Ú©Ø§Ù…Ù„ Russian gateways Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª
- Ø¯Ø± Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ Ù‡Ù†ÙˆØ² Russian gateways ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù†Ø¯

**Ø±Ø§Ù‡Ú©Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡:**

1. **Ø§Ø² origin/dev Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯** Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Russian gateway
2. **Ø§Ø² Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯** Ùˆ Ø³Ù¾Ø³ cleanup Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
3. **Ø·Ø¨Ù‚ MASTER-CLEANUP-GUIDE Ø¹Ù…Ù„ Ú©Ù†ÛŒØ¯:**
   - Week 1, Days 3-5: Ø­Ø°Ù 27 ÙØ§ÛŒÙ„ isolated
   - Week 2, Days 1-3: Surgical removal Ø§Ø² core files

---

### ØªØ¶Ø§Ø¯ 3: Currency Migration (Kopek â†’ Toman)

**Ù…Ø´Ú©Ù„:**
- Ø¯Ø± PRD FR10.2: ØªØ¨Ø¯ÛŒÙ„ Ø§Ø² kopeks Ø¨Ù‡ tomans Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª
- Ø¯Ø± config.py Ù‡Ù†ÙˆØ² `*_KOPEKS` ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
- Ø¯Ø± origin/dev Ù…Ù…Ú©Ù† Ø§Ø³Øª ØªØºÛŒÛŒØ±Ø§ØªÛŒ Ø¯Ø± currency ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯

**Ø±Ø§Ù‡Ú©Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡:**

1. âœ… **Ø§Ø² Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯** (ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ØªØ±)
2. âœ… **Migration script** Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ kopeks â†’ tomans
3. âœ… **Update config.py** Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `*_TOMANS`
4. âœ… **Update database models** Ø¨Ø±Ø§ÛŒ currency fields

**Ù…Ø±Ø§Ø­Ù„:**
```python
# Step 1: Add toman columns (nullable)
ALTER TABLE subscriptions ADD COLUMN price_tomans INTEGER;
ALTER TABLE transactions ADD COLUMN amount_tomans INTEGER;

# Step 2: Convert data (1 kopek = 0.1 toman)
UPDATE subscriptions SET price_tomans = price_kopeks / 10;
UPDATE transactions SET amount_tomans = amount_kopeks / 10;

# Step 3: Make toman columns non-nullable
ALTER TABLE subscriptions ALTER COLUMN price_tomans SET NOT NULL;
ALTER TABLE transactions ALTER COLUMN amount_tomans SET NOT NULL;

# Step 4: Drop kopek columns (after verification)
ALTER TABLE subscriptions DROP COLUMN price_kopeks;
ALTER TABLE transactions DROP COLUMN amount_kopeks;
```

---

### ØªØ¶Ø§Ø¯ 4: Localization (Russian â†’ Persian/English)

**Ù…Ø´Ú©Ù„:**
- Ø¯Ø± PRD FR11: ÙØ§Ø±Ø³ÛŒ primaryØŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ secondary
- Ø¯Ø± config.py: `DEFAULT_LANGUAGE: str = "en"`
- Ø¯Ø± origin/dev Ù…Ù…Ú©Ù† Ø§Ø³Øª localization Ù…ØªÙØ§ÙˆØª Ø¨Ø§Ø´Ø¯

**Ø±Ø§Ù‡Ú©Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡:**

1. âœ… **Ø§Ø² Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯**
2. âœ… **Merge Ø§Ø² `origin/debug/language`** - Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ localization Ù…ÙÛŒØ¯ Ù‡Ø³ØªÙ†Ø¯
3. âœ… **Update config.py:**
   ```python
   DEFAULT_LANGUAGE: str = "fa"  # Persian primary
   AVAILABLE_LANGUAGES: str = "fa,en"  # Persian + English
   ```
4. âœ… **Update localization files:**
   - `app/localization/locales/fa.json` (primary)
   - `app/localization/locales/en.json` (secondary)
   - Ø­Ø°Ù `ru.json`, `ua.json`, `zh.json` (Ø·Ø¨Ù‚ PRD)

---

### ØªØ¶Ø§Ø¯ 5: Currency Migration (Kopek â†’ Toman) - `origin/fix/replace-kopek-to-toman`

**ÙˆØ¶Ø¹ÛŒØª:** âœ… **Ù…ÙÛŒØ¯ - Ù‚Ø§Ø¨Ù„ Merge**

**ØªØ­Ù„ÛŒÙ„:**
- Ø§ÛŒÙ† Ø¨Ø±Ù†Ú† Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù‡Ù…Ø§Ù† Ú©Ø§Ø±ÛŒ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú©Ù‡ PRD FR10.2 Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯
- ØªØ¨Ø¯ÛŒÙ„ Ø§Ø² kopek Ø¨Ù‡ toman Ø¯Ø± ØªÙ…Ø§Ù… application
- Ø¨Ù‡Ø¨ÙˆØ¯ currency formatting

**Ø±Ø§Ù‡Ú©Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡:**

1. âœ… **Merge Ø§Ø² `origin/fix/replace-kopek-to-toman`**
2. âœ… **Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ±Ø§Øª:**
   - `app/config.py` - ØªØ¨Ø¯ÛŒÙ„ `*_KOPEKS` Ø¨Ù‡ `*_TOMANS`
   - `app/utils/currency_converter.py` - ØªØ¨Ø¯ÛŒÙ„ currency logic
   - ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ø² kopek Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
3. âœ… **ØªØ·Ø¨ÛŒÙ‚ Ø¨Ø§ PRD FR10.2:**
   - Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ØªØ¨Ø¯ÛŒÙ„ Ú©Ø§Ù…Ù„
   - Ø¨Ø±Ø±Ø³ÛŒ database migration scripts

**Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…:** Ø§ÛŒÙ† Ø¨Ø±Ù†Ú† **Ø¨Ø§ÛŒØ¯ merge Ø´ÙˆØ¯** - Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù‡Ù…Ø§Ù† Ú†ÛŒØ²ÛŒ Ø§Ø³Øª Ú©Ù‡ PRD Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯.

---

### ğŸš¨ Ø§Ù†Ø­Ø±Ø§Ù 1: Multi-Tenant Architecture - `origin/feat/multi-tenant-0` Ùˆ `origin/feat/multi-tenant-1`

**ÙˆØ¶Ø¹ÛŒØª:** âœ… **Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø§ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ bot_id Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† bot_id**

**ØªØ­Ù„ÛŒÙ„ Ø¬Ø¯ÛŒØ¯:**

Ø§Ú¯Ø± `bot_id` Ø±Ø§ Ù‡Ù…Ø§Ù† `bot_id` Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒÙ…ØŒ **85-90% Ú©Ø¯ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª**.

**Ø³Ø§Ø®ØªØ§Ø± Bot Model Ø¯Ø± multi-tenant-0/1:**

```python
class Bot(Base):
    __tablename__ = "bots"
    
    id = Column(Integer, primary_key=True)  # âœ… Ø§ÛŒÙ† Ù‡Ù…Ø§Ù† bot_id Ø§Ø³Øª
    telegram_bot_token = Column(String(255), unique=True)  # âœ… PRD: bot_token
    name = Column(String(255))  # âš ï¸ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ bot_username Ø¨Ø§Ø´Ø¯
    # ... ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
    
    # âŒ Missing: bot_username, owner_telegram_id, status, plan, settings
```

**Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ PRD FR1.1:**

| ÙÛŒÙ„Ø¯ PRD | ÙÛŒÙ„Ø¯ Bot | ÙˆØ¶Ø¹ÛŒØª | Action |
|----------|----------|-------|--------|
| `id` | `id` | âœ… **Ø³Ø§Ø²Ú¯Ø§Ø±** | OK |
| `bot_token` | `telegram_bot_token` | âœ… **Ø³Ø§Ø²Ú¯Ø§Ø±** | ÙÙ‚Ø· Ù†Ø§Ù… Ù…ØªÙØ§ÙˆØª |
| `bot_username` | âŒ **Ù†Ø¯Ø§Ø±Ø¯** | âš ï¸ **Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯** | Migration |
| `owner_telegram_id` | âŒ **Ù†Ø¯Ø§Ø±Ø¯** | âš ï¸ **Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯** | Migration |
| `status` | `is_active` (Boolean) | âš ï¸ **ØªØ¨Ø¯ÛŒÙ„ Ø´ÙˆØ¯** | Migration |
| `plan` | âŒ **Ù†Ø¯Ø§Ø±Ø¯** | âš ï¸ **Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯** | Migration |
| `settings` | âŒ **Ù†Ø¯Ø§Ø±Ø¯** | âš ï¸ **Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯** | ÛŒØ§ Ø§Ø² BotConfiguration |

**Ø±Ø§Ù‡Ú©Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ (ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯):**

1. âœ… **Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ bot_id Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† bot_id**
   - `bot_id = bot_id` (Ù‡Ù…Ø§Ù† Ú†ÛŒØ² Ø§Ø³Øª)
   - Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ rename Ù†ÛŒØ³Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ø³Øª)

2. âœ… **Merge Admin Panel (100% Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡)**
   ```
   âœ… app/handlers/admin/tenant_bots/*  # 16 ÙØ§ÛŒÙ„ - Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¢Ù…Ø§Ø¯Ù‡
   ```

3. âœ… **Merge Services (100% Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡)**
   ```
   âœ… app/services/bot_config_service.py
   âœ… app/database/crud/bot.py
   âœ… app/database/crud/bot_configuration.py
   âœ… app/database/crud/bot_feature_flag.py
   ```

4. âœ… **Merge Models (80% Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡)**
   - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† 5 ÙÛŒÙ„Ø¯ missing Ø¨Ù‡ Bot model
   - Migration Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§

**Ø¯Ø±ØµØ¯ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ:**

| Component | Ø¯Ø±ØµØ¯ | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|-----------|------|---------|
| Admin Panel | âœ… **100%** | Ú©Ø§Ù…Ù„Ø§Ù‹ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ |
| Services | âœ… **100%** | ÙÙ‚Ø· rename Ø§Ø®ØªÛŒØ§Ø±ÛŒ |
| Database CRUD | âœ… **100%** | ÙÙ‚Ø· rename Ø§Ø®ØªÛŒØ§Ø±ÛŒ |
| Models | âœ… **80%** | Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ |
| **Overall** | âœ… **85-90%** | Ø®ÛŒÙ„ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ |

**ØªÙˆØµÛŒÙ‡:** âœ… **Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² multi-tenant-0/1 Ø¨Ø§ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ bot_id**

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ…:**

```
âœ… app/handlers/admin/tenant_bots/* (16 ÙØ§ÛŒÙ„ - 100%)
âœ… app/services/bot_config_service.py (100%)
âœ… app/database/crud/bot*.py (3 ÙØ§ÛŒÙ„ - 100%)
âœ… app/database/models.py (Bot model - 80%)
```

**ØªØºÛŒÛŒØ±Ø§Øª Ù„Ø§Ø²Ù…:**

1. Migration: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† 5 ÙÛŒÙ„Ø¯ Ø¨Ù‡ Bot model
2. Rename Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Bot â†’ Tenant (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
3. ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ: TenantMiddleware, ContextVar, RLS

**Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ±:** Ø±Ø¬ÙˆØ¹ Ú©Ù†ÛŒØ¯ Ø¨Ù‡ `multi-tenant-branches-deep-analysis.md`

---

### ØªØ¶Ø§Ø¯ 6: Payments Feature - `origin/feat/payments`

**ÙˆØ¶Ø¹ÛŒØª:** âš ï¸ **Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚**

**ØªØ­Ù„ÛŒÙ„:**
- Ø§ÛŒÙ† Ø¨Ø±Ù†Ú† Ø´Ø§Ù…Ù„ ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø³Øª
- Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø´Ø§Ù…Ù„ Russian gateways Ø¨Ø§Ø´Ø¯ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ)
- Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø´Ø§Ù…Ù„ Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Ù…ÙÛŒØ¯ Ø¨Ø§Ø´Ø¯

**Ø±Ø§Ù‡Ú©Ø§Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡:**

1. âš ï¸ **Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚** Ù‚Ø¨Ù„ Ø§Ø² merge
2. âœ… **Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙÛŒØ¯:**
   - Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ payment flow
   - Bug fixes
   - Performance improvements
3. âŒ **Ø­Ø°Ù Russian gateway references** (Ø·Ø¨Ù‚ PRD FR10.1)

---

## ğŸ“‹ Plan Ø§Ø¬Ø±Ø§ÛŒÛŒ

### Phase 1: Merge ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙ…ÛŒØ² (1-2 Ø±ÙˆØ²)

**Ù…Ø±Ø­Ù„Ù‡ 1.1: BMAD Artifacts**
```bash
# Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ 100% ØªÙ…ÛŒØ² Ù‡Ø³ØªÙ†Ø¯
git checkout origin/dev
git checkout reagain-init -- _bmad-output/
git commit -m "docs: Add BMAD planning artifacts"
```

**Ù…Ø±Ø­Ù„Ù‡ 1.2: Features Ø¬Ø¯ÛŒØ¯ (Ø¨Ø¯ÙˆÙ† Russian gateway)**
```bash
# Merge ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙ…ÛŒØ²
git checkout reagain-init -- \
  app/handlers/admin/blacklist.py \
  app/handlers/admin/bulk_ban.py \
  app/handlers/admin/contests.py \
  app/services/blacklist_service.py \
  app/services/bulk_ban_service.py \
  # ... Ø³Ø§ÛŒØ± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙ…ÛŒØ²
```

**Ù…Ø±Ø­Ù„Ù‡ 1.3: ØªØµÙ…ÛŒÙ… Ø¯Ø±Ø¨Ø§Ø±Ù‡ CloudPayments**
```bash
# Ú¯Ø²ÛŒÙ†Ù‡ A: Ø­Ø°Ù CloudPayments
git rm app/database/crud/cloudpayments.py
git rm app/services/cloudpayments_service.py
# ... Ø­Ø°Ù ØªÙ…Ø§Ù… CloudPayments files

# Ú¯Ø²ÛŒÙ†Ù‡ B: Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ Ù…ÙˆÙ‚Øª (flag Ú©Ø±Ø¯Ù†)
# Ù‡ÛŒÚ† Ú©Ø§Ø±ÛŒ Ù†Ú©Ù†ÛŒØ¯ - Ø¨Ø¹Ø¯Ø§Ù‹ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯
```

---

### Phase 2: Cleanup ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡ (3-4 Ø±ÙˆØ²)

**Ù…Ø±Ø­Ù„Ù‡ 2.1: Ø­Ø°Ù Russian Gateway Files (27 ÙØ§ÛŒÙ„)**
```bash
# Ø·Ø¨Ù‚ MASTER-CLEANUP-GUIDE
# Week 1, Days 3-5
rm app/external/yookassa_webhook.py
rm app/external/wata_webhook.py
# ... 27 ÙØ§ÛŒÙ„
```

**Ù…Ø±Ø­Ù„Ù‡ 2.2: Surgical Removal Ø§Ø² Core Files**
```bash
# Week 2, Days 1-3
# Ø­Ø°Ù Russian gateway references Ø§Ø²:
# - app/services/payment_service.py
# - app/services/subscription_service.py
# - app/handlers/subscription/purchase.py
# - app/config.py
# ... 28 ÙØ§ÛŒÙ„
```

---

### Phase 3: ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ (2-3 Ø±ÙˆØ²)

**Ù…Ø±Ø­Ù„Ù‡ 3.1: Currency Migration**
```bash
# ØªØ¨Ø¯ÛŒÙ„ kopeks â†’ tomans
# Ø·Ø¨Ù‚ PRD FR10.2
```

**Ù…Ø±Ø­Ù„Ù‡ 3.2: Localization Update**
```bash
# ÙØ§Ø±Ø³ÛŒ primaryØŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ secondary
# Ø·Ø¨Ù‚ PRD FR11
```

**Ù…Ø±Ø­Ù„Ù‡ 3.3: Testing & Verification**
```bash
# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
pytest tests/ -v

# Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Russian gateway references
rg "yookassa|wata|heleket" app/ --type py
```

---

## ğŸ¯ Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ

### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Merge Ù…Ø³ØªÙ‚ÛŒÙ…

âœ… **~50 ÙØ§ÛŒÙ„** (BMAD artifacts + features Ø¬Ø¯ÛŒØ¯ ØªÙ…ÛŒØ²)

**Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯:**
- âœ… `origin/fix/replace-kopek-to-toman` - **Ø¨Ø§ÛŒØ¯ merge Ø´ÙˆØ¯** (PRD FR10.2)
- âœ… `origin/debug/language` - **Ù…ÙÛŒØ¯** - Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ localization

### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ

âš ï¸ **~95 ÙØ§ÛŒÙ„** (Russian gateway files + contaminated core files)

**Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ:**
- ğŸš¨ `origin/feat/multi-tenant-0` - **Ø§Ù†Ø­Ø±Ø§Ù Ø§Ø² PRD** - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Bot Ø¨Ù‡ Ø¬Ø§ÛŒ Tenant
- ğŸš¨ `origin/feat/multi-tenant-1` - **Ø§Ù†Ø­Ø±Ø§Ù Ø§Ø² PRD** - Ø§Ø¯Ø§Ù…Ù‡ multi-tenant-0
- âš ï¸ `origin/feat/payments` - **Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ** - Ù…Ù…Ú©Ù† Ø§Ø³Øª Russian gateways Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- âš ï¸ `origin/feat/tenant` - **Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ** - Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø§ PRD Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§Ø´Ø¯

### Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ

1. âœ… **Merge ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙ…ÛŒØ²** Ø§Ø² Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ
2. âœ… **Merge `origin/fix/replace-kopek-to-toman`** - Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ PRD FR10.2
3. âœ… **Merge `origin/debug/language`** - Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Ù…ÙÛŒØ¯
4. âŒ **Merge Ù†Ú©Ù†ÛŒØ¯** ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡ Ø§Ø² origin/dev
5. âš ï¸ **Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚** `origin/feat/payments` Ùˆ `origin/feat/tenant`
6. ğŸš¨ **Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ** `origin/feat/multi-tenant-0/1` - ØªØ¨Ø¯ÛŒÙ„ Bot â†’ Tenant
7. âœ… **Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ** ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù„ÙˆØ¯Ù‡ Ø·Ø¨Ù‚ PRD
8. âœ… **Ø­Ø°Ù CloudPayments** (Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ PRD)

---

## ğŸ“ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **Ø§Ø² origin/dev Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯** Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Russian gateway
2. **Ø§Ø² Ø¨Ø±Ù†Ú† ÙØ¹Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯** Ùˆ Ø³Ù¾Ø³ cleanup Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
3. **CloudPayments Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯** (Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ PRD)
4. **Ø·Ø¨Ù‚ MASTER-CLEANUP-GUIDE Ø¹Ù…Ù„ Ú©Ù†ÛŒØ¯** (4 Ù‡ÙØªÙ‡)
5. **PRD Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ú©Ù†ÛŒØ¯** Ø¨Ø§ ØªØµÙ…ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯
6. âœ… **Merge `origin/fix/replace-kopek-to-toman`** - Ø§ÛŒÙ† Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ PRD FR10.2 Ø§Ø³Øª
7. âœ… **Merge `origin/debug/language`** - Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Ù…ÙÛŒØ¯ localization
8. ğŸš¨ **Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ `origin/feat/multi-tenant-0/1`** - ØªØ¨Ø¯ÛŒÙ„ Bot â†’ Tenant Ø·Ø¨Ù‚ PRD
9. âš ï¸ **Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚ `origin/feat/payments` Ùˆ `origin/feat/tenant`** Ù‚Ø¨Ù„ Ø§Ø² merge

---

## ğŸ” Ø®Ù„Ø§ØµÙ‡ Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

### âœ… Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯ - Merge Ù…Ø³ØªÙ‚ÛŒÙ…

| Ø¨Ø±Ù†Ú† | ÙˆØ¶Ø¹ÛŒØª | Ø¯Ù„ÛŒÙ„ | Action |
|------|-------|------|--------|
| `origin/fix/replace-kopek-to-toman` | âœ… **Ù…ÙÛŒØ¯** | Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ PRD FR10.2 | **Merge Ú©Ù†ÛŒØ¯** |
| `origin/debug/language` | âœ… **Ù…ÙÛŒØ¯** | Ø¨Ù‡Ø¨ÙˆØ¯ localization | **Merge Ú©Ù†ÛŒØ¯** |

### âš ï¸ Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ø¨Ø±Ø±Ø³ÛŒ

| Ø¨Ø±Ù†Ú† | ÙˆØ¶Ø¹ÛŒØª | Ø¯Ù„ÛŒÙ„ | Action |
|------|-------|------|--------|
| `origin/feat/payments` | âš ï¸ **Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯** | Ù…Ù…Ú©Ù† Ø§Ø³Øª Russian gateways Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ | **Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯** |
| `origin/feat/tenant` | âš ï¸ **Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯** | Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø§ PRD Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§Ø´Ø¯ | **Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯** |
| `origin/dev` | âš ï¸ **Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯** | Ø´Ø§Ù…Ù„ localization refactoring + upstream changes | **Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯** |

### âœ… Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ (Ø¨Ø§ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ bot_id)

| Ø¨Ø±Ù†Ú† | ÙˆØ¶Ø¹ÛŒØª | Ø¯Ø±ØµØ¯ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ | Action |
|------|-------|-------------|--------|
| `origin/feat/multi-tenant-0` | âœ… **Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡** | **85-90%** | **Merge Ú©Ù†ÛŒØ¯** (Ø¨Ø§ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ bot_id) |
| `origin/feat/multi-tenant-1` | âœ… **Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡** | **85-90%** | **Merge Ú©Ù†ÛŒØ¯** (Ø¨Ø§ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ bot_id) |

**Ù†Ú©ØªÙ‡:** Ø§Ú¯Ø± `bot_id` Ø±Ø§ Ù‡Ù…Ø§Ù† `bot_id` Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒÙ…ØŒ 85-90% Ú©Ø¯ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.

**Ù†Ú©ØªÙ‡:** Ø§Ø² Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø¨Ø±Ù†Ú†â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ Ø§Ù…Ø§ Ø¨Ø§ Ù†Ø§Ù…â€ŒÚ¯Ø°Ø§Ø±ÛŒ PRD Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ú©Ù†ÛŒØ¯.

---

**ØªÙ‡ÛŒÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** Winston (Architect Agent)  
**ØªØ§Ø±ÛŒØ®:** 2025-12-26  
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ready for Review

